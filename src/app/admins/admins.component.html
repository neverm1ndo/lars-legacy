<div class="playerlog h-100 nopadding d-flex flex-column flex-fill align-self-stretch">
  <div class="wrapper-main overflow-auto d-flex align-items-stretch flex-fill">
    <div class="d-flex flex-column justify-content-center h-100 w-100">
      <div class="d-flex align-self-start w-100">
        <div class="col-12 adm-head">
          <div class="row">
            <div class="col-6">
              <h6><fa-icon [icon]="fa.agent"></fa-icon>Администраторский состав</h6>
            </div>
            <div class="col-6 text-right">
              <button [disabled]="userInfo.main_group !== 10" (click)="popup = true" class="btn btn-dark add-adm" type="button" name="button"><fa-icon class="mr-2" [icon]="fa.agent"></fa-icon> Добавить админа</button>
            </div>
          </div>
        </div>
      </div>
      <div class="d-flex flex-fill w-100 overflow-auto">
        <div class="col-12">
          <div class="row">
            <table *ngIf="admins.length > 0" class="table w-100">
              <thead class="overflow-auto">
                <th>ID</th>
                <th>Никнейм</th>
                <th>Основная группа</th>
                <th class="text-muted">Побочная группа</th>
                <th></th>
                <th></th>
              </thead>
              <tbody>
                <tr *ngFor="let admin of admins">
                  <td class="td-avatar">
                    <img class="avatar" src="{{admin.user_avatar}}" alt="">
                    <kbd>{{ admin.user_id }}</kbd>
                  </td>
                  <td class="td-username">
                    <a (click)="userLink(admin.user_id)">{{ admin.username }}</a><br>
                    <small>{{ admin.user_email }}</small><br>
                    <small *ngIf="userActivities[admin.username]">
                      <fa-icon [icon]="adminActivityIcon(userActivities[admin.username])"></fa-icon>
                      {{ userActivities[admin.username] | userAction }}
                    </small>
                  </td>
                  <td>
                    <ng-select [items]="roles"
                    bindLabel="val"
                    [searchable]="false"
                    [clearable]="false"
                    bindValue="id"
                    class="custom"
                    [disabled]="userInfo.main_group !== 10"
                    (change)="changeAdminGroup(admin.username, admin.user_id, admin.main_group)"
                    [(ngModel)]="admin.main_group">
                  </ng-select>
                </td>
                <td>
                  <ng-select [items]="subRoles"
                  bindLabel="val"
                  [searchable]="false"
                  [clearable]="false"
                  bindValue="id"
                  class="custom"
                  [disabled]="userInfo.main_group !== 10 || (admin.main_group == 10 || admin.main_group == 9)"
                  (change)="changeSecondaryAdminGroup(admin.username, admin.user_id, admin.secondary_group)"
                  [(ngModel)]="admin.secondary_group">
                </ng-select>
              </td>
              <td class="td-rm"><button (click)="removeAdmin(admin.username, admin.user_id)" [disabled]="userInfo.main_group !== 10" ngbTooltip="Исключить админа" placement="bottom" class="btn btn-dark rm-adm btn-36" type="button" name="button"><fa-icon [icon]="fa.agent"></fa-icon></button></td>
            </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div *ngIf="admins.length == 0" class="loader h-100 w-100 d-flex flex-column justify-content-center align-items-center">
        <div class="d-flex align-items-center">
          <lty-icon name="lty-logo" anim="spinner-logo"></lty-icon>
        </div>
      </div>
      <form [formGroup]="addAdminForm" (ngSubmit)="addNewAdmin()" *ngIf="popup" @settings class="popup d-flex flex-row justify-content-center align-items-center">
        <div class="popup-window d-flex flex-column">
          <div class="popup-window-head">
            <h5>Добавление админа</h5>
          </div>
          <div class="popup-window-body">
            <div class="row">
              <div class="col-6">
                <div class="form-group">
                              <input type="text"
                                     placeholder="Никнейм"
                                     class="form-control"
                                     id="nicknameInput"
                                     aria-describedby="nickname"
                                     formControlName="nickname"
                                     required>
                               <ng-select [items]="roles"
                                          bindLabel="val"
                                          [searchable]="false"
                                          [clearable]="false"
                                          bindValue="id"
                                          class="custom mt-2"
                                          formControlName="mainGroup">
                               </ng-select>
                               <ng-select [items]="roles"
                                          bindLabel="val"
                                          [searchable]="false"
                                          [clearable]="false"
                                          bindValue="id"
                                          class="custom mt-2"
                                          formControlName="secondaryGroup">
                               </ng-select>
                            </div>
                            <span>Форма изменяет <b>основную</b> группу зарегистрированного игрока на одну из администраторских групп.</span></div>
              <div class="col-6">
                <table class="table no-select">
                  <thead>
                    <th>Группа</th>
                    <th>Логи</th>
                    <th>Бан-лист</th>
                    <th>Ред. карт</th>
                    <th>Конф. файлов</th>
                    <th>Адм. состав</th>
                  </thead>
                              <tr>
                                <td>Претендент</td>
                                <td>✓</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                              </tr>
                              <tr>
                                <td>Админ</td>
                                <td>✓</td>
                                <td>✓</td>
                                <td></td>
                                <td></td>
                                <td></td>
                              </tr>
                              <tr>
                                <td>Маппер</td>
                                <td>✓</td>
                                <td></td>
                                <td>✓</td>
                                <td></td>
                                <td></td>
                              </tr>
                              <tr>
                                <td>Редактор конфигов</td>
                                <td>✓</td>
                                <td>✓</td>
                                <td></td>
                                <td>✓</td>
                                <td></td>
                              </tr>
                              <tr>
                                <td>Бэкапер</td>
                                <td>✓</td>
                                <td></td>
                                <td>✓</td>
                                <td>✓</td>
                                <td></td>
                              </tr>
                              <tr>
                                <td>Разработчик</td>
                                <td>✓</td>
                                <td>✓</td>
                                <td>✓</td>
                                <td>✓</td>
                                <td>✓</td>
                              </tr>
                            </table></div>
            </div>
          </div>
          <div class="popup-window-footer text-center">
            <div class="col-12">
              <div class="row">
                <div class="col-6 pl-0">
                  <button [disabled]="!addAdminForm.valid" type="submit" class="btn btn-light w-100" name="button">Добавить</button>
                </div>
                <div class="col-6 pr-0">
                  <button type="button" (click)="popup = false" class="btn btn-danger w-100" name="button">Отмена</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
